<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrightWing</title>
    <style>
        :root {
            --bg-color: #fce4ec;
            --clock-case: #fff0f5;
            --clock-border: #e1bee7;
            --gold-accent: #d4af37;
            --rose-gold: #e6c2bf;
            --deep-red: #c2185b;
            --heart-red: #e91e63;
            --text-color: #880e4f;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            background-image: radial-gradient(#f8bbd0 1px, transparent 1px);
            background-size: 30px 30px;
            margin: 0;
            font-family: 'Georgia', 'Times New Roman', serif;
            overflow: hidden;
            user-select: none;
            flex-direction: column;
        }

        /* Canvas para part√≠culas */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* --- PANTALLA 0: INICIO --- */
        .start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50; 
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        .start-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .start-screen h1 {
            color: var(--deep-red);
            font-family: 'Georgia', serif;
            font-style: italic;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .intro-image-container {
            width: 250px;
            height: 250px;
            border: 4px solid var(--rose-gold);
            border-radius: 20px; 
            overflow: hidden;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(136, 14, 79, 0.2);
            animation: float 4s ease-in-out infinite;
            background-color: #fff;
        }

        .intro-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .start-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .start-btn {
            padding: 15px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--deep-red), var(--heart-red));
            color: white;
            cursor: pointer;
            font-family: 'Georgia', serif;
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.6);
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        /* Modal para Fan Falsa */
        .modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 240, 245, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }
        
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-box {
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 3px dashed var(--deep-red);
            box-shadow: 0 10px 30px rgba(136, 14, 79, 0.2);
            max-width: 80%;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .modal-overlay.visible .modal-box {
            transform: scale(1);
        }
        
        .modal-box p {
            font-size: 1.3rem;
            color: var(--text-color);
            margin-bottom: 25px;
            font-weight: bold;
        }

        /* --- PANTALLA 1: RELOJ --- */
        .clock-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease;
            z-index: 10;
            opacity: 0; 
        }

        .clock-container.visible {
            opacity: 1;
        }

        .clock-container.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        /* Perillas */
        .knob {
            width: 45px;
            height: 55px;
            background: linear-gradient(135deg, #fce4ec, #f8bbd0);
            border: 2px solid var(--rose-gold);
            cursor: pointer;
            border-radius: 15px;
            position: absolute;
            z-index: 1;
            transition: transform 0.1s;
            box-shadow: 0 4px 10px rgba(136, 14, 79, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knob::before { content: '‚ô•'; color: var(--rose-gold); font-size: 1.2rem; opacity: 0.7; }
        .knob:active { transform: scale(0.95); }
        .knob.left { left: -35px; border-radius: 20px 5px 5px 20px; }
        .knob.right { right: -35px; border-radius: 5px 20px 20px 5px; }

        /* Reloj */
        .clock {
            width: 360px;
            height: 360px;
            background-color: var(--clock-case);
            border-radius: 50%;
            border: 12px solid #fff;
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-origin: center;
            animation: romantic-pulse 2s infinite ease-in-out;
        }
        
        @keyframes romantic-pulse {
            0% {
                transform: scale(1);
                box-shadow: 
                    0 0 0 4px var(--rose-gold),
                    0 0 0 10px #fff,
                    0 0 0 12px var(--rose-gold),
                    0 10px 30px rgba(136, 14, 79, 0.15);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 
                    0 0 0 4px var(--heart-red),
                    0 0 0 10px #fff,
                    0 0 0 12px var(--deep-red),
                    0 0 40px rgba(233, 30, 99, 0.4);
            }
            75% {
                 box-shadow: 
                    0 0 0 4px var(--gold-accent),
                    0 0 0 10px #fff,
                    0 0 0 12px var(--gold-accent),
                    0 10px 35px rgba(212, 175, 55, 0.3);
            }
            100% {
                transform: scale(1);
                box-shadow: 
                    0 0 0 4px var(--rose-gold),
                    0 0 0 10px #fff,
                    0 0 0 12px var(--rose-gold),
                    0 10px 30px rgba(136, 14, 79, 0.15);
            }
        }

        .clock.zoom-transition {
            animation: spinAndZoom 2.5s cubic-bezier(0.7, 0, 0.3, 1) forwards;
        }

        @keyframes spinAndZoom {
            0% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 0 4px var(--heart-red);
            }
            40% {
                transform: scale(0.8) rotate(-20deg); 
            }
            100% {
                transform: scale(20) rotate(720deg); 
                opacity: 0;
            }
        }

        .clock-face {
            width: 88%;
            height: 88%;
            background-color: #fff;
            border-radius: 50%;
            position: relative;
            box-shadow: inset 0 0 20px rgba(136, 14, 79, 0.05);
            background-image: radial-gradient(circle at center, #fff 60%, #fce4ec 100%);
        }

        .number {
            position: absolute; width: 100%; height: 100%;
            text-align: center; font-size: 2.2rem;
            color: var(--text-color); padding-top: 15px; box-sizing: border-box;
            pointer-events: none; text-shadow: 1px 1px 0 rgba(255,255,255,0.8);
        }
        .number span { display: inline-block; }

        .hand {
            position: absolute; bottom: 50%; left: 50%;
            transform-origin: bottom center; background-color: var(--deep-red);
            border-radius: 50% 50% 0 0; z-index: 5;
            transition: transform 0.05s cubic-bezier(0.4, 2.08, 0.55, 0.44);
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .hand::after { content: ''; position: absolute; background-color: #fff; border-radius: 50%; left: 50%; transform: translateX(-50%); }
        .hand.hour { width: 10px; height: 25%; background-color: var(--text-color); z-index: 3; }
        .hand.hour::after { width: 4px; height: 20px; top: 10px; }
        .hand.minute { width: 6px; height: 38%; background-color: var(--text-color); z-index: 4; }
        .hand.minute::after { width: 2px; height: 30px; top: 10px; }
        .hand.second { width: 2px; height: 42%; background-color: var(--heart-red); z-index: 5; }
        .hand.second::after { content: none; }
        .hand.second::before { content: '‚ô•'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); color: var(--heart-red); font-size: 14px; }

        .center-dot {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); z-index: 10;
            color: var(--gold-accent); font-size: 24px;
            transition: color 0.3s;
        }
        .center-dot::before { content: '‚ù§'; }

        .clock.ready .center-dot { color: var(--heart-red); }

        .controls-hint {
            position: absolute; bottom: 30px;
            color: var(--text-color); font-style: italic; font-size: 1rem;
            text-align: center; opacity: 0; transition: opacity 1s; /* Oculto inicialmente */
        }

        .controls-hint.visible {
            opacity: 0.8;
        }
        
        .brand {
            position: absolute; top: 60%; width: 100%; text-align: center;
            font-size: 1rem; letter-spacing: 3px; color: var(--rose-gold);
            font-weight: bold; text-transform: uppercase;
        }

        /* --- PANTALLA 2: GALER√çA DE MEMORIAS --- */
        .memories-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: transparent; 
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1.5s ease;
            z-index: 5;
        }

        .memories-screen.active {
            opacity: 1;
            visibility: visible;
            z-index: 20;
        }

        .video-grid {
            display: grid;
            grid-template-columns: 250px 300px 250px;
            grid-template-rows: 200px 200px;
            gap: 20px;
            max-width: 1000px;
            transform: scale(0.9);
            transition: transform 1s ease-out;
        }

        .memories-screen.active .video-grid {
            transform: scale(1);
        }

        .photo-frame {
            background-color: #fff;
            border: 4px solid var(--rose-gold);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--rose-gold);
            font-size: 1.5rem;
            font-weight: bold;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease, transform 1s ease;
        }

        .photo-frame.reveal {
            opacity: 1;
            transform: translateY(0);
            animation: float 4s ease-in-out infinite; 
        }
        
        .photo-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* El Mensaje Central */
        .central-message-container {
            grid-column: 2;
            grid-row: 1 / span 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            
            background: url('Fondo_k.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            
            padding: 20px;
            border-radius: 30px; 
            border: 2px dashed var(--deep-red);
            text-align: center;
            box-shadow: 0 0 30px rgba(233, 30, 99, 0.2);
            z-index: 25;
            animation: appearup 2s ease-out;
        }

        @keyframes appearup {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilos para el texto sincronizado */
        .sync-text {
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }
        
        .sync-text.visible {
            opacity: 1;
        }

        .central-message-container h2 {
            color: #FFFFFF;
            font-family: 'Georgia', serif;
            font-style: italic;
            font-size: 1.8rem;
            margin: 5px 0 10px 0;
            font-weight: 800;
            text-shadow: 3px 3px 6px #000000, 0 0 15px rgba(0,0,0,0.8);
        }

        .central-message-container p {
            color: #FFFFFF;
            line-height: 1.5;
            font-size: 1.1rem;
            margin: 5px 0;
            font-weight: 800;
            text-shadow: 3px 3px 6px #000000, 0 0 15px rgba(0,0,0,0.8);
        }

        .central-message-container strong {
            color: #FFD700;
            text-decoration: underline;
        }

        .heart-beat {
            color: #FF1493;
            font-size: 2.5rem;
            margin-top: 10px;
            animation: pulse 1s infinite;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.9);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 850px) {
            .video-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                width: 90%;
            }
            .photo-frame { height: 150px; }
            .central-message-container {
                grid-column: 1;
                grid-row: 1;
                margin-bottom: 20px;
                border-radius: 20px;
            }
        }
    </style>
</head>
<body>

    <!-- Canvas para Part√≠culas -->
    <canvas id="particles-canvas"></canvas>

    <!-- PANTALLA 0: INICIO -->
    <div class="start-screen" id="start-screen">
        <h1>Segunda prueba de picadores de colas</h1>
        <div class="intro-image-container">
            <img src="Vamos_m.jpeg" alt="Vamos" onerror="this.src='https://placehold.co/250x250/e6c2bf/880e4f?text=Vamos+M'">
        </div>
        <div class="start-buttons">
            <button class="start-btn" onclick="enterGame()">¬°vamos maricones!</button>
            <button class="start-btn" onclick="showFakeFanMessage()">Soy una fan de bl FALSA</button>
        </div>
        
        <div class="modal-overlay" id="fake-fan-modal">
            <div class="modal-box">
                <p>¬°Ya sabia! <br>Solo una fan verdadera no dudar√≠a...<br>JAJAJAJA</p>
                <button class="start-btn" onclick="enterGame()">Entrar con verg√ºenza y gans de picar colasüò≥</button>
            </div>
        </div>
    </div>

    <!-- PANTALLA 1: EL RELOJ -->
    <div class="clock-container" id="clock-container">
        <div class="knob left" id="knob-left"></div>
        
        <div class="clock" id="main-clock">
            <div class="clock-face" id="clock-face">
                <div class="brand">FirstKhao</div>
                <div class="hand hour" id="hour-hand"></div>
                <div class="hand minute" id="minute-hand"></div>
                <div class="hand second" id="second-hand"></div>
                <div class="center-dot"></div>
            </div>
        </div>

        <div class="knob right" id="knob-right"></div>
    </div>
    
    <div class="controls-hint" id="hint-text">
        "Encuentra el momento donde las agujas marcan las tres , y espera a que mi coraz√≥n lata en el diez ."
    </div>

    <!-- PANTALLA 2: GALER√çA DE MEMORIAS -->
    <div class="memories-screen" id="memories-screen">
        <div class="video-grid">
            <div class="photo-frame" id="FOTO_1">
                <img src="Foto_1.jpg" alt="Foto 1">
            </div>
            
            <div class="central-message-container">
                <h2 id="msg-title" class="sync-text">Para ti...</h2>
                <p>
                    <span id="msg-line-1" class="sync-text">Todos tenemos las mismas 24 horas en un d√≠a</span>
                    <br>
                    <span id="msg-line-2" class="sync-text">y a veces en esas 24 horas de alguien</span>
                    <br>
                    <span id="msg-line-3" class="sync-text">no somos parte, no somos tan especiales.</span>
                    <br><br>
                    <span id="msg-line-4" class="sync-text">Pero me gusta pensar...</span>
                    <br>
                    <span id="msg-line-5" class="sync-text">que t√∫ y yo somos la <strong>hora 25</strong> del otro.</span>
                </p>
                <div id="msg-heart" class="heart-beat sync-text">‚ù§</div>
            </div>

            <div class="photo-frame" id="FOTO_2">
                <img src="Foto_2.jpg" alt="Foto 2">
            </div>

            <div class="photo-frame" id="FOTO_3">
                <img src="Foto_3.jpg" alt="Foto 3">
            </div>

            <div class="photo-frame" id="FOTO_4">
                <img src="Foto_4.webp" alt="Foto 4">
            </div>
        </div>
    </div>

    <script>
        const hourHand = document.getElementById('hour-hand');
        const minuteHand = document.getElementById('minute-hand');
        const secondHand = document.getElementById('second-hand');
        const clockFace = document.getElementById('clock-face');
        const mainClock = document.getElementById('main-clock');
        const knobLeft = document.getElementById('knob-left');
        const knobRight = document.getElementById('knob-right');
        const clockContainer = document.getElementById('clock-container');
        const hintText = document.getElementById('hint-text');
        const memoriesScreen = document.getElementById('memories-screen');
        const startScreen = document.getElementById('start-screen');
        const fakeFanModal = document.getElementById('fake-fan-modal');
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');

        const romanNumerals = [
            'XII', 'I', 'II', 'III', 'IV', 'V', 
            'VI', 'VII', 'VIII', 'IX', 'X', 'XI'
        ];

        romanNumerals.forEach((num, index) => {
            const numberDiv = document.createElement('div');
            numberDiv.classList.add('number');
            const rotation = index * 30;
            numberDiv.style.transform = `rotate(${rotation}deg)`;
            const span = document.createElement('span');
            span.innerText = num;
            span.style.transform = `rotate(-${rotation}deg)`;
            numberDiv.appendChild(span);
            clockFace.appendChild(numberDiv);
        });

        // Usamos var para evitar errores de redeclaraci√≥n en el entorno de desarrollo
        var timeOffset = 0; 
        var interactionInterval = null;
        var isUnlocked = false;
        var audioCtx = null;
        var heartbeatInterval = null;
        var isAudioInitialized = false;

        // --- SISTEMA DE PART√çCULAS ---
        var particles = [];
        var canvasW, canvasH; // Variables renombradas para evitar conflictos

        function resizeCanvas() {
            canvasW = canvas.width = window.innerWidth;
            canvasH = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.reset(true);
            }

            reset(initial = false) {
                this.x = Math.random() * canvasW;
                this.y = initial ? Math.random() * canvasH : canvasH + 10;
                this.speed = Math.random() * 0.8 + 0.4; // M√°s velocidad (antes 0.5 + 0.2)
                this.size = Math.random() * 5 + 2; // M√°s tama√±o (antes 3 + 1)
                this.opacity = Math.random() * 0.5 + 0.3; // M√°s opacidad (antes 0.5 + 0.1)
                this.oscillation = Math.random() * 2;
                this.oscillationSpeed = Math.random() * 0.02;
                
                // Determinar tipo de part√≠cula seg√∫n estado del juego
                if (isUnlocked) {
                    // MODO FINAL: Corazones y destellos
                    const rand = Math.random();
                    if (rand > 0.7) this.type = 'heart';
                    else if (rand > 0.4) this.type = 'sparkle';
                    else this.type = 'circle';
                    this.text = null;
                } else {
                    // MODO RELOJ: C√≠rculos y PISTAS DE TEXTO
                    const rand = Math.random();
                    if (rand > 0.95) { // M√°s frecuencia de pistas (antes 0.98)
                        this.type = 'text';
                        // Pistas del puzzle
                        const hints = ['25', 'XV', '15', 'X', '10', 'III'];
                        this.text = hints[Math.floor(Math.random() * hints.length)];
                        this.size = 16 + Math.random() * 14; // Texto m√°s grande (antes 12 + 10)
                        this.opacity = 0.5; // Texto mucho m√°s visible (antes 0.15)
                    } else {
                        this.type = 'circle';
                        this.text = null;
                    }
                }
            }

            update() {
                this.y -= this.speed;
                this.x += Math.sin(this.y * 0.01 + this.oscillation) * 0.5;
                
                if (this.y < -50) {
                    this.reset();
                }
            }

            draw() {
                ctx.globalAlpha = this.opacity;
                
                if (this.type === 'text') {
                    ctx.font = `italic ${this.size}px Georgia`;
                    ctx.fillStyle = '#880e4f'; // Color vino sutil
                    ctx.fillText(this.text, this.x, this.y);
                } else if (this.type === 'heart') {
                    ctx.fillStyle = '#e91e63';
                    ctx.font = `${this.size * 3}px serif`;
                    ctx.fillText('‚ô•', this.x, this.y);
                } else if (this.type === 'sparkle') {
                    ctx.fillStyle = '#d4af37'; // Oro
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // C√≠rculo por defecto (polvo)
                    ctx.fillStyle = '#e6c2bf'; // Oro rosa
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.globalAlpha = 1;
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < 120; i++) { // Aumentado de 60 a 120 part√≠culas
                particles.push(new Particle());
            }
            animateParticles();
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvasW, canvasH);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateParticles);
        }

        // ---------------------------

        function initAudio() {
            if (isAudioInitialized) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                audioCtx = new AudioContext();
                isAudioInitialized = true;
                startHeartbeatLoop();
            }
        }

        function showFakeFanMessage() {
            initAudio(); 
            fakeFanModal.classList.add('visible');
        }

        function enterGame() {
            initAudio();
            startScreen.classList.add('hidden');
            clockContainer.classList.add('visible');
            hintText.classList.add('visible');
            // Iniciar part√≠culas al entrar al reloj
            initParticles();
        }

        function playHeartbeatSound() {
            if (!audioCtx || isUnlocked) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const createThud = (time, freq, decay) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(freq, time);
                osc.frequency.exponentialRampToValueAtTime(freq * 0.5, time + decay);
                gain.gain.setValueAtTime(0, time);
                gain.gain.linearRampToValueAtTime(0.5, time + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.01, time + decay);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(time);
                osc.stop(time + decay + 0.1);
            };
            createThud(t, 60, 0.2);
            createThud(t + 0.15, 70, 0.15);
        }

        function startHeartbeatLoop() {
            if (heartbeatInterval) clearInterval(heartbeatInterval);
            playHeartbeatSound();
            heartbeatInterval = setInterval(() => {
                if (isUnlocked) {
                    clearInterval(heartbeatInterval);
                    return;
                }
                playHeartbeatSound();
            }, 2000);
        }

        function updateClock() {
            if (isUnlocked) return;
            const now = new Date(Date.now() + timeOffset);
            const seconds = now.getSeconds();
            // FORZAR LA HORA A LAS 3:00
            const minutes = 0;
            const hours = 3; 

            const secondsDegrees = ((seconds / 60) * 360);
            const minutesDegrees = ((minutes / 60) * 360) + ((seconds/60)*6);
            const hoursDegrees = ((hours / 12) * 360) + ((minutes/60)*30);
            
            secondHand.style.transform = `rotate(${secondsDegrees}deg)`;
            minuteHand.style.transform = `rotate(${minutesDegrees}deg)`;
            hourHand.style.transform = `rotate(${hoursDegrees}deg)`;
            
            checkPuzzle(hours, minutes, seconds);
        }

        function checkPuzzle(h, m, s) {
            const isHourTarget = (h % 12) === 3;
            const isMinuteTarget = m === 0;
            if (isHourTarget && isMinuteTarget) {
                mainClock.classList.add('ready');
            } else {
                mainClock.classList.remove('ready');
            }
            const isSecondTarget = s === 50;
            if (isHourTarget && isMinuteTarget && isSecondTarget) {
                triggerTransition();
            }
        }

        function playSuccessSound() {
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const playNote = (freq, delay, duration = 2) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine'; 
                osc.frequency.value = freq;
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const now = audioCtx.currentTime + delay;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.2, now + 0.1); 
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration); 
                osc.start(now);
                osc.stop(now + duration);
            };
            playNote(523.25, 0);    
            playNote(659.25, 0.2);  
            playNote(783.99, 0.4);  
            playNote(987.77, 0.6);  
            playNote(1046.50, 0.8, 3.0); 
            playNote(261.63, 0, 3.0); 
        }

        function triggerTransition() {
            isUnlocked = true;
            if (heartbeatInterval) clearInterval(heartbeatInterval);
            playSuccessSound();

            setTimeout(() => {
                const bgMusic = new Audio('Music_fondo.mp3');
                bgMusic.volume = 0.05; // Volumen 5%
                bgMusic.loop = true; 
                bgMusic.play().catch(e => console.log("Error bg music:", e));

                const msgAudio = new Audio('hora_25.mp3'); 
                msgAudio.volume = 1.0; 
                msgAudio.play().catch(e => console.log("Error msg audio:", e));
                
                startTextSync();
                
                // Reiniciar part√≠culas para que cambien al modo "amor" (corazones)
                particles.forEach(p => p.reset());
                
            }, 3000);

            mainClock.classList.add('zoom-transition');
            hintText.style.opacity = '0';

            setTimeout(() => {
                clockContainer.classList.add('fade-out');
                memoriesScreen.classList.add('active');
                startPhotoSequence();
            }, 1800);
        }

        function startTextSync() {
            setTimeout(() => document.getElementById('msg-title').classList.add('visible'), 500);
            setTimeout(() => document.getElementById('msg-line-1').classList.add('visible'), 2500);
            setTimeout(() => document.getElementById('msg-line-2').classList.add('visible'), 6000);
            setTimeout(() => document.getElementById('msg-line-3').classList.add('visible'), 9000);
            setTimeout(() => document.getElementById('msg-line-4').classList.add('visible'), 13000);
            setTimeout(() => document.getElementById('msg-line-5').classList.add('visible'), 16000);
            setTimeout(() => document.getElementById('msg-heart').classList.add('visible'), 19000);
        }

        function startPhotoSequence() {
            const photos = ['FOTO_1', 'FOTO_2', 'FOTO_3', 'FOTO_4'];
            photos.forEach((id, index) => {
                setTimeout(() => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.classList.add('reveal');
                    }
                }, index * 5000); 
            });
        }

        function adjustTime(direction) {
            initAudio();
            const speed = 60000; 
            timeOffset += (speed * direction);
            updateClock();
        }

        function startAdjusting(direction) {
            if (isUnlocked) return;
            adjustTime(direction);
            interactionInterval = setInterval(() => {
                adjustTime(direction);
            }, 100);
        }

        function stopAdjusting() {
            clearInterval(interactionInterval);
        }

        knobLeft.addEventListener('mousedown', () => startAdjusting(-1));
        knobLeft.addEventListener('touchstart', (e) => { e.preventDefault(); startAdjusting(-1); });
        
        knobRight.addEventListener('mousedown', () => startAdjusting(1));
        knobRight.addEventListener('touchstart', (e) => { e.preventDefault(); startAdjusting(1); });

        window.addEventListener('mouseup', stopAdjusting);
        window.addEventListener('touchend', stopAdjusting);

        setInterval(updateClock, 1000);
        updateClock();

    </script>
</body>
</html>
